---
layout:     post                    # 使用的布局（不需要改）
title:      理想监控系统            # 标题
subtitle:   长什么样                #副标题
date:       2018-08-09              # 时间
author:     west                    # 作者
header-img: img/post_green.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - 监控系统
---

> 本文主要参考陈皓大哥的文章，在此基础之上结合自己的想法做了一个总结，还请多多指教。

## Why need 监控 ??

#### 监控系统起源与发展

###### 起源
- 分布式系统的出现是由于单机的性能瓶颈。
- 为了解决这个问题，必须将单体应用拆分到不同的机器上，不同的机器提供不同的服务来协同完成一件事。这就是分布式系统的演变过程。随着而来有很多问题，其中有个非常典型的问题即是。
    - **如果分布式系统一台机器出现问题，特别是支付行业，如何及时发现并挽救损失？？**
    - 答案就是**监控**，这就是监控系统出现的最直接原因。

###### 发展
- *那么接下的问题就变成，如何打造一个符合要求的监控系统。为此，我们需要做到的目标为：*
    - **全栈监控**
    
    ![](https://static001.geekbang.org/resource/image/cf/66/cf6fe8ee30a3ac3b693d1188b46e4e66.png)
    - **全链路监控**
        - ***Google Dapper -> 对应的开源实现Zipkin***
        - 国内：美团的 CAT，淘宝 eagle eye，微博的 Watchman，还有听云 Server 等

## 什么是好的监控系统

#### 特征
- 关注于整体应用的 SLA（service-level agreement)
    - 即为对外提供的服务质量，关系到服务的可用性 
- 关联指标聚合
    - 服务的具体实例和主机关联在一起,比如服务有可能运行在JVM OR Tomcat..
- 快速故障定位
    - 关键在于对一个请求的 trace 监控 

#### 监控什么
- **监控对象(全栈监控)**

![](https://static001.geekbang.org/resource/image/cf/66/cf6fe8ee30a3ac3b693d1188b46e4e66.png)
- **请求链路(全链路监控)**

![](https://static001.geekbang.org/resource/image/ab/81/ab79054e0a3cf2d8f1d696e3c367ab81.png)

#### 能力

- 体检能力
    - 性能管理
        - **通过系统大盘，找到系统瓶颈，并有针对性地优化系统和相应代码** 
    - 容量管理
        - 提供一个全局的系统运行时数据的展示，为**扩容OR服务降级**提供决策依据 
- 急诊能力
    - 定位问题
        - **以快速地暴露并找到问题的发生点，帮助技术人员诊断问题** 
    - 性能分析
        - **非预期的性能问题出现时，可以快速地找到系统的瓶颈，并可以帮助开发人员深入代码。** 

## 最终效果

> 当我们做好以上要求的一些细节之后，当问题出现时，能达到的效果
- **了解故障的影响面**：
    - 当一台机器挂掉是因为 CPU 或 I/O ， SQL 操作过慢 过高的时候，马上可以知道其会影响到哪些对外服务的 API
    - 当一个服务响应过慢的时候，我们马上能关联出来是否在做 Java GC，或是其所在的计算结点上是否有资源不足的情况，或是依赖的服务是否出现了问题
- **可以做出调度**：
    - 现某个服务过慢是因为 CPU 使用过多，就可以做弹性伸缩
    - 发现某个服务过慢是因为 MySQL 出现了一个慢查询，就无法在应用层上做弹性伸缩，只能做流量限制，或是降级操作了
- **最终目的 -> 自动化运维**：
    - 自动化扩容 OR 服务降级

![](https://static001.geekbang.org/resource/image/6b/33/6b17dd779cfecd62e02924dc8618e833.png)


